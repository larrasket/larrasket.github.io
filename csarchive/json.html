<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>JSON in C# Using Json.NET</title>
<meta name="author" content="Salih Muhammed" />
<meta name="generator" content="Org Mode" />
<link rel="icon" href="/favicon.ico">
<meta name="theme-color" content="#ffffff">
<meta charset="utf-8">
<link rel="stylesheet" href="/style/main.css"/>


<script async data-id="101390423" src="//static.getclicky.com/js"></script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/101390423ns.gif" /></p></noscript>

<script>
  window.onload = function() {
    // get the current URL path
    var path = window.location.pathname;

    // select all navigation links
    var links = document.querySelectorAll('#preamble .center li a');

    // iterate through each link and replace the link with a span if it matches the current path
    links.forEach(function(link) {
      // compare the link's href attribute with the current path
      if (link.getAttribute('href') === path) {
        var span = document.createElement('span');
        span.innerHTML = link.innerHTML;
        span.classList.add('current');
        link.parentNode.replaceChild(span, link);
      }
    });
  };
</script>

<script>
function toggleImage(link, src) {
  var container = link.nextElementSibling;
  if (container.style.display === "none") {
    container.style.display = "block";
    link.textContent = "Click here again to hide";
  } else {
    container.style.display = "none";
    link.textContent = "Click here again to display it";
  }
  event.preventDefault();
}
</script>

	<style>
		.hide {
			display: none;
		}
	</style>
	<script>
		function hideDates() {
			var dates = document.querySelectorAll('p, i');
			for (var i = 0; i < dates.length; i++) {
				var dateRegex = /\(\d{4}\/\d{2}\/\d{2}\)/g;
				if (dateRegex.test(dates[i].innerHTML)) {
					dates[i].innerHTML = dates[i].innerHTML.replace(dateRegex, '<span class="hide">$&</span>');
				}
			}
			document.getElementById("show-link").style.display = "inline";
			document.getElementById("hide-link").style.display = "none";
		}

		function showDates() {
			var dates = document.getElementsByClassName("hide");
			for (var i = 0; i < dates.length; i++) {
				dates[i].style.display = "inline";
			}
			document.getElementById("hide-link").style.display = "inline";
			document.getElementById("show-link").style.display = "none";
		}
	</script>
</head>
<body>
<div id="preamble" class="status">
<header>

</header>
</div>
<div id="content" class="content">
<header>
<h1 class="title">JSON in C# Using Json.NET</h1>
</header><div class="PREVIEW" id="orge5a5cf3">
<p>
One of the most popular .NET libraries for working with the JSON serialization
format is Newtonsoft.Json, known as Json.NET. It is mature and powerful.
</p>

</div>

<div id="outline-container-org628caee" class="outline-2">
<h2 id="org628caee">Introduction</h2>
<div class="outline-text-2" id="text-org628caee">
<p>
Let's start by defining what JSON is. JSON stands for JavaScript Object Notation.  It is a
data interchange format that is used to transmit and store serialized information.  One
example can be from a web page to a server, or to store data in a large object repository.
The beauty is that it's an open standard, and it is human readable text. JSON's design goals
were for it to be minimal, portable, textual, and a subset of JavaScript.  And this is an
example of JSON.  As you can see, you have a key value pairs, you can have arrays, dates, it
supports Booleans, nulls, and nested objects.
</p>


<p>
JSON, the JavaScript Object Notation, was created by Douglas Crockford in 2001.  The
official site is json.org. Visit it for more details on this data interchange format.  It
goes straight to the point in explaining JSON, and as you can see at the top, it mentions
one of the standards that describes JSON, which in fact is described by two standards. One
is RFC 8259, which covers the specification, semantics, and security considerations.  It was
not the first one. You can also check RFC 7159, 7158, and 4627 for a bigger look at the
history. And then, ECMA‑404, which is the minimal specification. It covers the allowed
grammar syntax.  And now, let's talk about Json.NET.  It was started by James Newton‑King in
2005 out of the need of working with JSON in projects that had JavaScript, AJAX, and .NET.
It started as a couple of static methods for escaping strings, but it evolved and it was
first released as Json.NET in 2006 with an unimaginable amount of hours of work. So a big
thank you to him.  It is used by thousands of projects, so much so that it's the most
downloaded library in NuGet's history.  In 2018, Json.NET joined the .NET Foundation.  It
was originally hosted in CodePlex, but now, as most open source projects, it is in GitHub.
James works for Microsoft by day, and he says he's not Batman.
</p>


<p>
Why is JSON important?  Given that it was originally based on a subset of JavaScript, and
considering how important JavaScript currently is, one of the best parts is that JSON is
supported natively by JavaScript. However, and this is pretty good as well, it is language
independent, but uses conventions that are familiar to programmers of the C family of
languages, including C, C++, Java, Perl, Python, and many others.  This makes JSON a great
option for other things like storing data, which is why it also has been adopted for all
types of storage platforms, including NoSQL databases and search engines, to name a few.
JSON also has the concept of types.  It is worth noting that it supports some un‑escaped
characters that are not allowed in JavaScript.  But in general, JSON is supported by the
major languages, like Ruby, Objective‑C, Java, C#, Python, and so on and so forth.
Something else that's quite notable is that developers want out of the syntax business.
With XML, you can represent the same data in multiple different ways.  There are some
differences in the metadata. This can lead to confusion or errors.  XML can get tiring to
read and understand.  I do agree that this complexity comes with some advantages in terms of
flexibility; however, the question is how much flexibility?  It all depends.  But in
general, JSON covers the wide majority of cases. And it goes so far that Douglas Crockford,
the creator of JSON, as we recently found out, called it the fat‑free alternative to XML.
And I think he's right.  Which takes me to my next point.  Many applications expose an API,
which in many cases followed the REST architectural style.  And even though these APIs
support different formats besides JSON, like XML, JSON's readability and the fact that it is
quite lightweight make JSON very suitable and one of the preferred formats for data
exchange, which is why JSON is used in a large number of APIs.
</p>
</div>
<div id="outline-container-org052ed4a" class="outline-3">
<h3 id="org052ed4a">Json Specification</h3>
<div class="outline-text-3" id="text-org052ed4a">
<p>
JSON is a text format for the serialization of structured data as a collection of name‑value
pairs.  JSON can represent four primitive types, which are strings, numbers, Booleans, and
null.  Also, there are two structured types, objects and arrays.  Regarding duplicate keys,
ECMA‑404 has no mention of unique keys.  You can have two authors with the same name.  But
RFC 8259 states that names within an object should be unique, which helps for all
implementations to agree on name‑value mappings. When no duplicates are present, Json.NET
takes the last value.
</p>

<p>
A number is a decimal number with a fractional part and may use an exponential annotation.
JSON does not allow Not a Number, or NaN, nor does it make any distinction between integer
and floating point. Even though JavaScript uses double‑precision floating point format for
all of its numeric values, other languages implementing JSON may encode numbers
differently.  String is a sequence of zero or more unicode characters.  Strings are
delimited with double quotation marks and support a backslash escaping syntax. Boolean can
be either the values true or false. Array is a list of zero or more values in which you use
square bracket notation with elements being comma separated.  An object is an unordered
collection of name‑value pairs where the names, also called keys, are strings.  Objects are
delimited with curly brackets and use commas to separate each pair, while within each pair,
a colon separates the key or name from its value.  ECMA 404 states that most program
languages will have some feature for representing such collections, which can go by names
like record, str, dict, map, hash, object, or class.  Null is an empty value using the word
null. And whitespace is ignored outside of the values.  JSON generally ignores any
whitespace around or between syntactic elements, values and punctuation, but not within a
string.  However, JSON only recognizes four specific whitespace characters, the space, the
center tab, line feed, and carriage return.  JSON does not provide or allow any sort of
comment syntax.
</p>
</div>
</div>
</div>
<div id="outline-container-org151d447" class="outline-2">
<h2 id="org151d447">Serialization &amp; Deserialization</h2>
<div class="outline-text-2" id="text-org151d447">
</div>
<div id="outline-container-orgb55032d" class="outline-3">
<h3 id="orgb55032d">Basic Serialization</h3>
<div class="outline-text-3" id="text-orgb55032d">
<p>
Serialization and deserialization involve taking a data structure or object and converting
it back and forth between JSON text and .NET objects. A .NET object, when serialized,can be
stored as a stream of bytes, a file, or in‑memory,and later it can be used to recreate the
original object. You have to be careful,though, in some cases there are private
implementation details,so you need to review the recreated object to determine if there's
any information that's missing.
</p>

<p>
In the serialization and deserialization process, you map property names and copy their
values using the main JsonSerializer class with the support of JsonReader and JsonWriter.
</p>

<p>
The JsonSerializer class is a straightforward way of converting between JSON text and .NET
objects. It provides a great deal of control and customization,being able to read and write
directly to streams via JsonTextReader and JsonTextWriter. Simply use the serialize and
deserialize methods. And it gets even better, Json.NET comes with a very easy‑to‑use wrapper
over JsonSerializer called JsonConvert that makes the serialization process that easy for
most scenarios. Simply use the SerializeObject and DeserializeObject methods. You control
the serialization and deserialization process via settings and attributes, which will be
covered in the next module. But first, let's see JsonConvert in action.
</p>

<p>
After adding <a href="https://www.nuget.org/packages/Newtonsoft.Json">Newtonsoft.Json</a> to your project, you are ready to use it directly:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">using</span> <span style="font-weight: bold; font-style: italic;">Newtonsoft</span>.<span style="font-weight: bold; font-style: italic;">Json</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">json</span> = Generate.<span style="font-weight: bold;">SingleJson</span>();
</pre>
</div>

<p>
The <code>Generate.SingleJson()</code> is a method inside the <code>Generate</code> static class, you can check it
out in the source code of the repository, however, all it does that it returns the <code>json</code>
file needed for this demonstration:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">static</span> <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold;">SingleJson</span>()
{
    <span style="font-weight: bold;">return</span> File.<span style="font-weight: bold;">ReadAllText</span>(<span style="font-style: italic;">"AuthorSingle.json"</span>);
}
</pre>
</div>

<p>
The <code>AuthorSingle.json</code> is so simple:
</p>
<div class="org-src-container">
<pre class="src src-json">{
  "name": "Xavier Morera",
  "courses": [
    "Solr",
    "Spark",
    "Python",
    "T-SQL"
  ],
  "since": "2014-01-14T00:00:00",
  "happy": true,
  "issues": null,
  "car": {
    "model": "Land Rover Series III",
    "year": 1976
  },
  "authorRelationship": 1
}
</pre>
</div>
<p>
A very vital mission in using <code>JSON</code> in <code>C#</code>, is to write the corresponding class for it in
<code>C#</code>, it's called <code>POCO</code> which stands for <i>Plain old CLR object</i>, in this case, I'm going to
give it the <code>JsonObject</code> attribute.
</p>
<div class="org-src-container">
<pre class="src src-csharp">[<span style="font-weight: bold;">JsonObject</span>(IsReference = <span style="font-weight: bold; text-decoration: underline;">true</span>)]
<span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> Author
{
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">name</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span>[] <span style="font-weight: bold; font-style: italic;">courses</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">DateTime</span> <span style="font-weight: bold; font-style: italic;">since</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">bool</span> <span style="font-weight: bold; font-style: italic;">happy</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">object</span> <span style="font-weight: bold; font-style: italic;">issues</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">Car</span> <span style="font-weight: bold; font-style: italic;">car</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Author</span>&gt; <span style="font-weight: bold; font-style: italic;">favoriteAuthors</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">AuthorRelationship</span> <span style="font-weight: bold; font-style: italic;">authorRelationship</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
}
</pre>
</div>
<p>
The <code>Car</code> and <code>AuthorRelationship</code> Classes doesn't contain any attribute:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">enum</span> <span style="font-weight: bold; text-decoration: underline;">AuthorRelationship</span>
{
    <span style="font-weight: bold; font-style: italic;">EmployeeAuthor</span>,
    <span style="font-weight: bold; font-style: italic;">IndependentAuthor</span>
}
<span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Car</span>
{
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">model</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">year</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
}
</pre>
</div>
<p>
Back to <code>string json</code>, it should contain the Json text file, let's check it:
</p>
<div class="org-src-container">
<pre class="src src-csharp">Console.<span style="font-weight: bold;">WriteLine</span>(<span style="font-weight: bold; text-decoration: underline;">json</span>);
</pre>
</div>

<p>
Now let's try to run our first deserialize, the method <code>DeserializeObject()</code> is inside the
<code>JsonConvert</code> class, which is one of the most useful classes of Json.NET as it helps
serialize and deserialize in a very easy way.
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">Author</span> <span style="font-weight: bold; font-style: italic;">x</span> = JsonConvert.<span style="font-weight: bold;">DeserializeObject</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Author</span>&gt;(json);
Console.<span style="font-weight: bold;">WriteLine</span>(x.name);
</pre>
</div>

<p>
Reversing it is so much easier:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">y</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(x);
Console.<span style="font-weight: bold;">WriteLine</span>(y);
</pre>
</div>

<p>
You may notice that it isn't very well fromated, well, fix it! Just add the
<code>Formatting.Indented</code> parameter in calling:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">y</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(x, Formatting.Indented);
Console.<span style="font-weight: bold;">WriteLine</span>(y);
</pre>
</div>
<p>
Just like magic!
</p>
</div>
</div>

<div id="outline-container-org94e31e9" class="outline-3">
<h3 id="org94e31e9"><code>PreserveReferencesHandling</code></h3>
<div class="outline-text-3" id="text-org94e31e9">
<p>
These settings can best be explained by example. Let's say that we want to represent a
hierarchy of employees in a company. So we make a simple class like this:
</p>


<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Employee</span>
{
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">Name</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Employee</span>&gt; <span style="font-weight: bold; font-style: italic;">Subordinates</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
}
</pre>
</div>

<p>
This is a small company with only three employees so far: Angela, Bob and Charles. Angela is
the boss, while Bob and Charles are her subordinates. Let's set up the data to describe this
relationship:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">Employee</span> <span style="font-weight: bold; font-style: italic;">angela</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Employee</span> { <span style="font-weight: bold; font-style: italic;">Name</span> = <span style="font-style: italic;">"Angela Anderson"</span> };
<span style="font-weight: bold; text-decoration: underline;">Employee</span> <span style="font-weight: bold; font-style: italic;">bob</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Employee</span> { <span style="font-weight: bold; font-style: italic;">Name</span> = <span style="font-style: italic;">"Bob Brown"</span> };
<span style="font-weight: bold; text-decoration: underline;">Employee</span> <span style="font-weight: bold; font-style: italic;">charles</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Employee</span> { <span style="font-weight: bold; font-style: italic;">Name</span> = <span style="font-style: italic;">"Charles Cooper"</span> };
angela.Subordinates = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Employee</span>&gt; { <span style="font-weight: bold; font-style: italic;">bob</span>, <span style="font-weight: bold; font-style: italic;">charles</span> };
<span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Employee</span>&gt; <span style="font-weight: bold; font-style: italic;">employees</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Employee</span>&gt; { <span style="font-weight: bold; font-style: italic;">angela</span>, <span style="font-weight: bold; font-style: italic;">bob</span>, <span style="font-weight: bold; font-style: italic;">charles</span> };
</pre>
</div>

<p>
If we serialize the list of employees to JSON:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">json</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(employees, Formatting.Indented);
Console.<span style="font-weight: bold;">WriteLine</span>(json);
</pre>
</div>

<p>
We get:
</p>
<div class="org-src-container">
<pre class="src src-csharp">[
  {
    <span style="font-style: italic;">"Name"</span>: <span style="font-style: italic;">"Angela Anderson"</span>,
    <span style="font-style: italic;">"Subordinates"</span>: [
      {
        <span style="font-style: italic;">"Name"</span>: <span style="font-style: italic;">"Bob Brown"</span>,
        <span style="font-style: italic;">"Subordinates"</span>: <span style="font-weight: bold; text-decoration: underline;">null</span>
      },
      {
        <span style="font-style: italic;">"Name"</span>: <span style="font-style: italic;">"Charles Cooper"</span>,
        <span style="font-style: italic;">"Subordinates"</span>: <span style="font-weight: bold; text-decoration: underline;">null</span>
      }
    ]
  },
  {
    <span style="font-style: italic;">"Name"</span>: <span style="font-style: italic;">"Bob Brown"</span>,
    <span style="font-style: italic;">"Subordinates"</span>: <span style="font-weight: bold; text-decoration: underline;">null</span>
  },
  {
    <span style="font-style: italic;">"Name"</span>: <span style="font-style: italic;">"Charles Cooper"</span>,
    <span style="font-style: italic;">"Subordinates"</span>: <span style="font-weight: bold; text-decoration: underline;">null</span>
  }
]
</pre>
</div>

<p>
So far so good. You'll notice, however, that the information for Bob and Charles is repeated
in the JSON because the objects representing them are referenced both by the main list of
employees and Angela's list of subordinates. Maybe that's OK for now.
</p>

<p>
Now suppose we'd also like to have a way to keep track of each Employee's supervisor in
addition to his or her subordinates. So we change our Employee model to add a Supervisor
property&#x2026;
</p>


<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Employee</span>
{
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">Name</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">Employee</span> <span style="font-weight: bold; font-style: italic;">Supervisor</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Employee</span>&gt; <span style="font-weight: bold; font-style: italic;">Subordinates</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
}
</pre>
</div>

<p>
&#x2026;and add a couple more lines to our setup code to indicate that Charles and Bob report to Angela:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">Employee</span> <span style="font-weight: bold; font-style: italic;">angela</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Employee</span> { <span style="font-weight: bold; font-style: italic;">Name</span> = <span style="font-style: italic;">"Angela Anderson"</span> };
<span style="font-weight: bold; text-decoration: underline;">Employee</span> <span style="font-weight: bold; font-style: italic;">bob</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Employee</span> { <span style="font-weight: bold; font-style: italic;">Name</span> = <span style="font-style: italic;">"Bob Brown"</span> };
<span style="font-weight: bold; text-decoration: underline;">Employee</span> <span style="font-weight: bold; font-style: italic;">charles</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Employee</span> { <span style="font-weight: bold; font-style: italic;">Name</span> = <span style="font-style: italic;">"Charles Cooper"</span> };

angela.Subordinates = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Employee</span>&gt; { <span style="font-weight: bold; font-style: italic;">bob</span>, <span style="font-weight: bold; font-style: italic;">charles</span> };
bob.Supervisor = angela;       <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">added this line</span>
charles.Supervisor = angela;   <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">added this line</span>

<span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Employee</span>&gt; <span style="font-weight: bold; font-style: italic;">employees</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Employee</span>&gt; { <span style="font-weight: bold; font-style: italic;">angela</span>, <span style="font-weight: bold; font-style: italic;">bob</span>, <span style="font-weight: bold; font-style: italic;">charles</span> };
</pre>
</div>

<p>
But now we have a bit of a problem. Because the object graph has reference loops in it (e.g.
angela references bob while bob references angela), we will get a JsonSerializationException
when we try to serialize the employees list. One way we can get around this issue is by
setting ReferenceLoopHandling to Ignore like this:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span> <span style="font-weight: bold; font-style: italic;">settings</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span>
{
    <span style="font-weight: bold; font-style: italic;">ReferenceLoopHandling</span> = ReferenceLoopHandling.Ignore,
    <span style="font-weight: bold; font-style: italic;">Formatting</span> = Formatting.Indented
};

<span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">json</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(employees, settings);
</pre>
</div>


<p>
With this setting in place, we get the following JSON:
</p>


<div class="org-src-container">
<pre class="src src-json">[
  {
    "Name": "Angela Anderson",
    "Supervisor": null,
    "Subordinates": [
      {
        "Name": "Bob Brown",
        "Subordinates": null
      },
      {
        "Name": "Charles Cooper",
        "Subordinates": null
      }
    ]
  },
  {
    "Name": "Bob Brown",
    "Supervisor": {
      "Name": "Angela Anderson",
      "Supervisor": null,
      "Subordinates": [
        {
          "Name": "Charles Cooper",
          "Subordinates": null
        }
      ]
    },
    "Subordinates": null
  },
  {
    "Name": "Charles Cooper",
    "Supervisor": {
      "Name": "Angela Anderson",
      "Supervisor": null,
      "Subordinates": [
        {
          "Name": "Bob Brown",
          "Subordinates": null
        }
      ]
    },
    "Subordinates": null
  }
]
</pre>
</div>

<p>
If you examine the JSON, it should be clear what this setting does: any time the serializer
encounters a reference back to an object it is already in the process of serializing, it
simply skips that member. (This prevents the serializer from getting into an infinite loop.)
You can see that in Angela's list of subordinates in the top part of the JSON, neither Bob
nor Charles show a supervisor. In the bottom part of the JSON, Bob and Charles both show
Angela as their supervisor, but notice her subordinates list at that point does not include
both Bob and Charles.
</p>

<p>
While it is possible to work with this JSON and maybe even reconstruct the original object
hierarchy from it with some work, it is clearly not optimal. We can eliminate the repeated
information in the JSON while still preserving the object references by using the
PreserveReferencesHandling setting instead:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span> <span style="font-weight: bold; font-style: italic;">settings</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span>
{
    <span style="font-weight: bold; font-style: italic;">PreserveReferencesHandling</span> = PreserveReferencesHandling.Objects,
    <span style="font-weight: bold; font-style: italic;">Formatting</span> = Formatting.Indented
};
</pre>
</div>

<p>
We get:
</p>
<div class="org-src-container">
<pre class="src src-json">[
  {
    "$id": "1",
    "Name": "Angela Anderson",
    "Supervisor": null,
    "Subordinates": [
      {
        "$id": "2",
        "Name": "Bob Brown",
        "Supervisor": {
          "$ref": "1"
        },
        "Subordinates": null
      },
      {
        "$id": "3",
        "Name": "Charles Cooper",
        "Supervisor": {
          "$ref": "1"
        },
        "Subordinates": null
      }
    ]
  },
  {
    "$ref": "2"
  },
  {
    "$ref": "3"
  }
]

</pre>
</div>
</div>
</div>

<div id="outline-container-org58d9180" class="outline-3">
<h3 id="org58d9180">Reading and Writing JSON</h3>
<div class="outline-text-3" id="text-org58d9180">
<p>
I showed you how easy it is to convert between JSON text and .NET object using JsonConvert.
I showed you a setting or two, but I didn't go into too many details. JsonConvert is very
straightforward, but is it a one‑size‑fits‑all thing?  The answer is No. If you want
control, you can take it up a notch using the JsonSerializer class, which has two classes
that will be useful for us,the JsonReader and JsonWriter.  JsonReader is, as the name
implies, used for reading JSON. It's non‑cache and forward only.  It's used for large object
and files.  There are different types of readers,the JsonTextReader being the one that we
will cover now.  On the other hand, you have JsonWriter, which is used for creating JSON.
It's also non‑cached, forward only, and allows you to have a lot more control when
generating JSON data. I will also cover now JsonTextWriter.
</p>
</div>

<div id="outline-container-org7382a0c" class="outline-4">
<h4 id="org7382a0c"><code>JsonSerializer</code> Class</h4>
<div class="outline-text-4" id="text-org7382a0c">
<p>
You can use JsonSerializer class with a StreamWriter. If you don't know what a StreamWriter
is, it's a class that allows you to write to files.  Create a new StreamWriter and provide
as parameter the name of the file where I intend to write the serialized JSON text. For this
example, I will call it testingjsonfile.json. Next, I instantiate a new JsonSerializer
class, and I call the Serialize function.
</p>


<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">static</span> <span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">Main</span>(<span style="font-weight: bold; text-decoration: underline;">string</span>[] <span style="font-weight: bold; font-style: italic;">args</span>)
{
    <span style="font-weight: bold;">using</span> (<span style="font-weight: bold; text-decoration: underline;">StreamWriter</span> <span style="font-weight: bold; font-style: italic;">sw</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">StreamWriter</span>(<span style="font-style: italic;">"./testingjsonfile.json"</span>))
    {
        <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">json</span> = Generate.<span style="font-weight: bold;">SingleJson</span>();
        <span style="font-weight: bold; text-decoration: underline;">JsonSerializer</span> <span style="font-weight: bold; font-style: italic;">fsz</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializer</span>();
        fsz.<span style="font-weight: bold;">Serialize</span>(sw, json);
    }
}
</pre>
</div>

<p>
You can use settings like serializer.NullValueHandling=NullValueHandling.Ignore; to ignore
null value. You should be able to find the file in the running directory.
</p>
</div>
</div>

<div id="outline-container-orga0d8c0d" class="outline-4">
<h4 id="orga0d8c0d"><code>JsonTextReader</code> Class</h4>
<div class="outline-text-4" id="text-orga0d8c0d">
<p>
JsonConvert, and ultimately, the Json Serializer class
used reflection to convert from JSON text to .NET classes. Even though Json.NET is very
fast, by using reflection, it makes it a little bit slower that it can actually beat. And
thus, we have the JsonTextReader, which does not use reflection and provides the fastest way
of reading JSON text.
</p>

<div class="org-src-container">
<pre class="src src-csharp">JsonTextReader <span style="font-weight: bold; text-decoration: underline;">j</span> <span style="font-weight: bold; font-style: italic;">reader</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonTextReader</span>(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">StringReader</span> (JsonSample));
</pre>
</div>

<p>
I pass a new StringReader with the author JSON. Do you know why a string reader? There is a
very important reason. In .NET, strings are immutable, so if you keep modifying a string
without using a stringbuilder, you will be suffering from a deep performance hit. So always
remember to use it. And then, I start reading data with a jsonReader:
</p>


<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">static</span> <span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">textreader</span>()
{
    <span style="font-weight: bold; text-decoration: underline;">JsonTextReader</span> <span style="font-weight: bold; font-style: italic;">rdr</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonTextReader</span>(<span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">StringReader</span>(smpl));
    <span style="font-weight: bold;">while</span> (rdr.<span style="font-weight: bold;">Read</span>())
    {
        <span style="font-weight: bold;">if</span> (rdr.Value != <span style="font-weight: bold; text-decoration: underline;">null</span>)
        {
            Console.<span style="font-weight: bold;">WriteLine</span>(<span style="font-style: italic;">"Token: "</span> +  rdr.TokenType + <span style="font-style: italic;">" Value: "</span>, rdr.Value);
        } <span style="font-weight: bold;">else</span>
            Console.<span style="font-weight: bold;">WriteLine</span>(<span style="font-style: italic;">"Token: "</span> + rdr.TokenType);
    }
}
</pre>
</div>

<p>
A token is just one element of the JSON object. I can check jsonReader. TokenType
to get further information. If I add a QuickWatch, I can see that the first token is the
start object, which makes sense. I will keep reading further and the next token is a
property name.
</p>
</div>
</div>
<div id="outline-container-org5e99539" class="outline-4">
<h4 id="org5e99539"><code>JsonTextWriter</code> Class</h4>
<div class="outline-text-4" id="text-org5e99539">
<p>
With JsonConvert, you take one class, you make one
call, and you get a JSON text. But what happens if you want to write your JSON text in a
manual way? First of all, why do you want to write it manually? Performance and control.
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">StringBuilder</span> <span style="font-weight: bold; font-style: italic;">sb</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">StringBuilder</span>();
<span style="font-weight: bold; text-decoration: underline;">StringWriter</span> <span style="font-weight: bold; font-style: italic;">sw</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">StringWriter</span>(sb);

<span style="font-weight: bold;">using</span> (<span style="font-weight: bold; text-decoration: underline;">JsonWriter</span> <span style="font-weight: bold; font-style: italic;">writer</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonTextWriter</span>(sw))
{
    writer.Formatting = Formatting.Indented;

    writer.<span style="font-weight: bold;">WriteStartObject</span>();
    writer.<span style="font-weight: bold;">WritePropertyName</span>(<span style="font-style: italic;">"CPU"</span>);
    writer.<span style="font-weight: bold;">WriteValue</span>(<span style="font-style: italic;">"Intel"</span>);
    writer.<span style="font-weight: bold;">WritePropertyName</span>(<span style="font-style: italic;">"PSU"</span>);
    writer.<span style="font-weight: bold;">WriteValue</span>(<span style="font-style: italic;">"500W"</span>);
    writer.<span style="font-weight: bold;">WritePropertyName</span>(<span style="font-style: italic;">"Drives"</span>);
    writer.<span style="font-weight: bold;">WriteStartArray</span>();
    writer.<span style="font-weight: bold;">WriteValue</span>(<span style="font-style: italic;">"DVD read/writer"</span>);
    writer.<span style="font-weight: bold;">WriteComment</span>(<span style="font-style: italic;">"(broken)"</span>);
    writer.<span style="font-weight: bold;">WriteValue</span>(<span style="font-style: italic;">"500 gigabyte hard drive"</span>);
    writer.<span style="font-weight: bold;">WriteValue</span>(<span style="font-style: italic;">"200 gigabyte hard drive"</span>);
    writer.<span style="font-weight: bold;">WriteEnd</span>();
    writer.<span style="font-weight: bold;">WriteEndObject</span>();
}

Console.<span style="font-weight: bold;">WriteLine</span>(sb.<span style="font-weight: bold;">ToString</span>());
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">{</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"CPU": "Intel",</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"PSU": "500W",</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Drives": [</span>
<span style="font-weight: bold; font-style: italic;">//     </span><span style="font-weight: bold; font-style: italic;">"DVD read/writer"</span>
<span style="font-weight: bold; font-style: italic;">//     </span><span style="font-weight: bold; font-style: italic;">/*(broken)*/,</span>
<span style="font-weight: bold; font-style: italic;">//     </span><span style="font-weight: bold; font-style: italic;">"500 gigabyte hard drive",</span>
<span style="font-weight: bold; font-style: italic;">//     </span><span style="font-weight: bold; font-style: italic;">"200 gigabyte hard drive"</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">]</span>
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">}</span>

</pre>
</div>
</div>
</div>

<div id="outline-container-orgd1bf419" class="outline-4">
<h4 id="orgd1bf419">Date with JSON</h4>
<div class="outline-text-4" id="text-orgd1bf419">
<p>
Let's talk about a topic that confuses developers all the time when working with JSON dates.
The thing is, that dates in JSON are tricky mainly because there is no date type, but it's
not JSON's fault. The real reason is that JavaScript does not have a date literal. It's
either represented by a string or a number. The string is just a written representation of
the date, and a number represents milliseconds since January 1 1970, what's known as a Unix
epoch. Json.NET uses the standard ISO 8601, although it used before the Microsoft format.
Let's jump straight into the demo, Dates in JSON with Json.NET. I start by creating a list
of dates. You probably already know this, but in .NET there are several ways of creating a
date.
</p>


<p>
The default format used by Json.NET is the ISO 8601 standard: <code>"2012-03-19T07:22Z"</code>.
</p>

<p>
Prior to Json.NET 4.5 dates were written using the Microsoft format:
<code>"\/Date(1198908717056)\/".</code> If you want to use this format, or you want to maintain
compatibility with Microsoft JSON serializers or older versions of Json.NET, then change the
DateFormatHandling setting to MicrosoftDateFormat.
</p>

<p>
The DateTimeZoneHandling setting can be used to convert a DateTime's DateTimeKind when
serializing. For example set DateTimeZoneHandling to Utc to serialize all DateTimes as UTC
dates. Note that this setting does not effect DateTimeOffsets.
</p>

<p>
If your dates don't follow the ISO 8601 standard, then the DateFormatString setting can be
used to customize the format of date strings that are read and written using .NET's custom
date and time format syntax.
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">LogEntry</span>
{
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">Details</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">DateTime</span> <span style="font-weight: bold; font-style: italic;">LogDate</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
}

[<span style="font-weight: bold; font-style: italic;">Test</span>]
<span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">WriteJsonDates</span>()
{
    <span style="font-weight: bold; text-decoration: underline;">LogEntry</span> <span style="font-weight: bold; font-style: italic;">entry</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">LogEntry</span>
    {
        <span style="font-weight: bold; font-style: italic;">LogDate</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">DateTime</span>(2009, 2, 15, 0, 0, 0, DateTimeKind.Utc),
        <span style="font-weight: bold; font-style: italic;">Details</span> = <span style="font-style: italic;">"Application started."</span>
    };

    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">default as of Json.NET 4.5</span>
    <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">isoJson</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(entry);
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">{"Details":"Application started.","LogDate":"2009-02-15T00:00:00Z"}</span>

    <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span> <span style="font-weight: bold; font-style: italic;">microsoftDateFormatSettings</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span>
    {
        <span style="font-weight: bold; font-style: italic;">DateFormatHandling</span> = DateFormatHandling.MicrosoftDateFormat
    };
    <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">microsoftJson</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(entry, microsoftDateFormatSettings);
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">{"Details":"Application started.","LogDate":"\/Date(1234656000000)\/"}</span>

    <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">javascriptJson</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(entry, <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JavaScriptDateTimeConverter</span>());
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">{"Details":"Application started.","LogDate":new Date(1234656000000)}</span>
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc8a460f" class="outline-4">
<h4 id="orgc8a460f">Error Handling</h4>
<div class="outline-text-4" id="text-orgc8a460f">
<p>
Errors happen all the time, especially with JSON generated by a third party or one that
you're picking up on a log or an API or some storage location. What's really good is that in
Json.NET, you can specify what you want to do with the errors. You can either handle them or
throw them.
</p>

<p>
First, I will generate this JSON array that contains,
a few dates. But some of these values are not a date. If I ask JSON to
deserialize them into a date, an exception will be raised:
</p>


<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">string</span>&gt; <span style="font-weight: bold; font-style: italic;">errors</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">string</span>&gt;();

<span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">DateTime</span>&gt; <span style="font-weight: bold; font-style: italic;">c</span> = JsonConvert.DeserializeObject&lt;<span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">DateTime</span>&gt;&gt;(@<span style="font-style: italic;">"[</span>
<span style="font-style: italic;">      '2009-09-09T00:00:00Z',</span>
<span style="font-style: italic;">      'I am not a date and will error!',</span>
<span style="font-style: italic;">      [</span>
<span style="font-style: italic;">        1</span>
<span style="font-style: italic;">      ],</span>
<span style="font-style: italic;">      '1977-02-20T00:00:00Z',</span>
<span style="font-style: italic;">      null,</span>
<span style="font-style: italic;">      '2000-12-01T00:00:00Z'</span>
<span style="font-style: italic;">    ]"</span>,
    <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span>
    {
        <span style="font-weight: bold; font-style: italic;">Error</span> = <span style="font-weight: bold;">delegate</span>(<span style="font-weight: bold; text-decoration: underline;">object</span> <span style="font-weight: bold; font-style: italic;">sender</span>, ErrorEventArgs args)
        {
            errors.<span style="font-weight: bold;">Add</span>(args.ErrorContext.Error.Message);
            args.ErrorContext.Handled = <span style="font-weight: bold; text-decoration: underline;">true</span>;
        },
        Converters = { <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">IsoDateTimeConverter</span>() }
    });

<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">2009-09-09T00:00:00Z</span>
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">1977-02-20T00:00:00Z</span>
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">2000-12-01T00:00:00Z</span>

<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">The string was not recognized as a valid DateTime. There is a unknown word starting at index 0.</span>
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Unexpected token parsing date. Expected String, got StartArray.</span>
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">Cannot convert null value to System.DateTime.</span>
</pre>
</div>

<p>
In this example we are deserializing a JSON array to a collection of DateTimes. On the
JsonSerializerSettings a handler has been assigned to the Error event which will log the
error message and mark the error as handled.
</p>

<p>
The result of deserializing the JSON is three successfully deserialized dates and three
error messages: one for the badly formatted string ("I am not a date and will error!"), one
for the nested JSON array, and one for the null value since the list doesn't allow nullable
DateTimes. The event handler has logged these messages and Json.NET has continued on
deserializing the JSON because the errors were marked as handled.
</p>

<p>
One thing to note with error handling in Json.NET is that an unhandled error will bubble up
and raise the event on each of its parents. For example an unhandled error when serializing
a collection of objects will be raised twice, once against the object and then again on the
collection. This will let you handle an error either where it occurred or on one of its
parents.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org1f0ae79" class="outline-2">
<h2 id="org1f0ae79">Settings &amp; Attributes</h2>
<div class="outline-text-2" id="text-org1f0ae79">
</div>
<div id="outline-container-org8c945b0" class="outline-3">
<h3 id="org8c945b0">Serialization Settings</h3>
<div class="outline-text-3" id="text-org8c945b0">
<p>
JsonSerializer has a number of properties on it to customize how it serializes JSON. These
can also be used with the methods on JsonConvert via the JsonSerializerSettings overloads.
</p>
</div>
<div id="outline-container-org88e76bc" class="outline-4">
<h4 id="org88e76bc"><code>MissingMemberHandling</code></h4>
<div class="outline-text-4" id="text-org88e76bc">
<p>
MissingMemberHandling controls how missing members, e.g. JSON contains a property that isn't
a member on the object, are handled during deserialization.
</p>

<p>
<b>Ignore:</b> By default Json.NET ignores JSON if there is no field or property for its value to be set to during deserialization.
</p>

<p>
<b>Error</b>: Json.NET errors when there is a missing member during deserialization.
</p>

<p>
For demonstration I will comment out a property from the <code>author</code> class, let it be <code>name</code>:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Author</span>
{
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">public string name { get; set; }</span>
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span>[] <span style="font-weight: bold; font-style: italic;">courses</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">DateTime</span> <span style="font-weight: bold; font-style: italic;">since</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">bool</span> <span style="font-weight: bold; font-style: italic;">happy</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">object</span> <span style="font-weight: bold; font-style: italic;">issues</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">Car</span> <span style="font-weight: bold; font-style: italic;">car</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Author</span>&gt; <span style="font-weight: bold; font-style: italic;">favoriteAuthors</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">AuthorRelationship</span> <span style="font-weight: bold; font-style: italic;">authorRelationship</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
}
</pre>
</div>

<p>
Now let's try to deserialize a random json file:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">static</span> <span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">MissingMemebers</span>()
{
    <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span> <span style="font-weight: bold; font-style: italic;">st</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span>();
    st.Formatting = Formatting.Indented;
    <span style="font-weight: bold; text-decoration: underline;">Author</span> <span style="font-weight: bold; font-style: italic;">myar</span> = JsonConvert.<span style="font-weight: bold;">DeserializeObject</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Author</span>&gt;(smpl, st);
}
</pre>
</div>

<p>
This should work by default, to change this behavior, assign <code>error</code> to 1:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span> <span style="font-weight: bold; font-style: italic;">st</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span>();
st.Formatting = Formatting.Indented;
st.MissingMemberHandling = MissingMemberHandling.Error;
<span style="font-weight: bold; text-decoration: underline;">Author</span> <span style="font-weight: bold; font-style: italic;">myar</span> = JsonConvert.<span style="font-weight: bold;">DeserializeObject</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Author</span>&gt;(smpl, st);
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdba8a60" class="outline-4">
<h4 id="orgdba8a60"><code>ReferenceLoopHandling</code></h4>
<div class="outline-text-4" id="text-orgdba8a60">
<p>
NullValueHandling controls how null values on .NET objects are handled during serialization
and how null values in JSON are handled during deserialization.
</p>


<p>
<b>Include:</b> By default Json.NET writes null values to JSON when serializing and sets null
values to fields/properties when deserializing.
</p>

<p>
<b>Ignore:</b> Json.NET will skip writing JSON properties if the .NET value is null when
 serializing and will skip setting fields/properties if the JSON property is null when
 deserializing.
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Movie</span>
{
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">Name</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">Description</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">Classification</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">Studio</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">DateTime</span>? <span style="font-weight: bold; font-style: italic;">ReleaseDate</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">List</span>&lt;<span style="font-weight: bold; text-decoration: underline;">string</span>&gt; <span style="font-weight: bold; font-style: italic;">ReleaseCountries</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">Movie</span> <span style="font-weight: bold; font-style: italic;">movie</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Movie</span>();
movie.Name = <span style="font-style: italic;">"Bad Boys III"</span>;
movie.Description = <span style="font-style: italic;">"It's no Bad Boys"</span>;

<span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">included</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(movie,
    Formatting.Indented,
    <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span> { });

<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">{</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Name": "Bad Boys III",</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Description": "It's no Bad Boys",</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Classification": null,</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Studio": null,</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"ReleaseDate": null,</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"ReleaseCountries": null</span>
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">}</span>

<span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">ignored</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(movie,
    Formatting.Indented,
    <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span> { <span style="font-weight: bold; font-style: italic;">NullValueHandling</span> = NullValueHandling.Ignore });

<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">{</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Name": "Bad Boys III",</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Description": "It's no Bad Boys"</span>
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org21e9fd2" class="outline-4">
<h4 id="org21e9fd2"><code>DefaultValueHandling</code></h4>
<div class="outline-text-4" id="text-org21e9fd2">
<p>
DefaultValueHandling controls how Json.NET uses default values set using the .NET
DefaultValueAttribute when serializing and deserializing.
</p>

<p>
<b>Include:</b> By default Json.NET will write a field/property value to JSON when serializing if
the value is the same as the field/property's default value. The Json.NET deserializer will
continue setting a field/property if the JSON value is the same as the default value.
</p>

<p>
<b>Ignore:</b> Json.NET will skip writing a field/property value to JSON if the value is the same
 as the field/property's default value, or the custom value specified in
 DefaultValueAttribute if the attribute is present. The Json.NET deserializer will skip
 setting a .NET object's field/property if the JSON value is the same as the default value.
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Invoice</span>
{
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">Company</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">decimal</span> <span style="font-weight: bold; font-style: italic;">Amount</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }

    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">false is default value of bool</span>
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">bool</span> <span style="font-weight: bold; font-style: italic;">Paid</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">null is default value of nullable</span>
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">DateTime</span>? <span style="font-weight: bold; font-style: italic;">PaidDate</span> { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }

    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">customize default values</span>
    [<span style="font-weight: bold;">DefaultValue</span>(30)]
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">int</span> FollowUpDays { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }

    [<span style="font-weight: bold;">DefaultValue</span>(<span style="font-style: italic;">""</span>)]
    <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">string</span> FollowUpEmailAddress { <span style="font-weight: bold;">get</span>; <span style="font-weight: bold;">set</span>; }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold; text-decoration: underline;">Invoice</span> <span style="font-weight: bold; font-style: italic;">invoice</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">Invoice</span>
{
    <span style="font-weight: bold; font-style: italic;">Company</span> = <span style="font-style: italic;">"Acme Ltd."</span>,
    <span style="font-weight: bold; font-style: italic;">Amount</span> = 50.0m,
    <span style="font-weight: bold; font-style: italic;">Paid</span> = <span style="font-weight: bold; text-decoration: underline;">false</span>,
    <span style="font-weight: bold; font-style: italic;">FollowUpDays</span> = 30,
    <span style="font-weight: bold; font-style: italic;">FollowUpEmailAddress</span> = <span style="font-weight: bold; text-decoration: underline;">string</span>.Empty,
    <span style="font-weight: bold; font-style: italic;">PaidDate</span> = <span style="font-weight: bold; text-decoration: underline;">null</span>
};

<span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">included</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(invoice,
    Formatting.Indented,
    <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span> { });

<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">{</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Company": "Acme Ltd.",</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Amount": 50.0,</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Paid": false,</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"PaidDate": null,</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"FollowUpDays": 30,</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"FollowUpEmailAddress": ""</span>
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">}</span>

<span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">ignored</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(invoice,
    Formatting.Indented,
    <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span> { <span style="font-weight: bold; font-style: italic;">DefaultValueHandling</span> = DefaultValueHandling.Ignore });

<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">{</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Company": "Acme Ltd.",</span>
<span style="font-weight: bold; font-style: italic;">//   </span><span style="font-weight: bold; font-style: italic;">"Amount": 50.0</span>
<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">}</span>
</pre>
</div>
</div>


<div id="outline-container-org3a9808d" class="outline-5">
<h5 id="org3a9808d"><span class="todo TODO">TODO</span> Populate</h5>
</div>
</div>
<div id="outline-container-orgc19defb" class="outline-4">
<h4 id="orgc19defb"><code>ObjectCreationHandling</code></h4>
<div class="outline-text-4" id="text-orgc19defb">
<p>
Specifies how object creation is handled by the JsonSerializer. ObjectCreationHandling
controls how objects are created and deserialized to during deserialization.
</p>


<p>
<b>Auto:</b> By default Json.NET will attempt to set JSON values onto existing objects and add
JSON values to existing collections during deserialization.
</p>

<p>
<b>Reuse:</b> Same behaviour as auto.
</p>

<p>
<b>Replace:</b> Json.NET will always recreate objects and collections before setting values to
them during deserialization.
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">static</span> <span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">CreationHandlier</span>()
{
    <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span> <span style="font-weight: bold; font-style: italic;">st</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span>();
    st.Formatting = Formatting.Indented;
    st.ObjectCreationHandling = ObjectCreationHandling.Replace;
    <span style="font-weight: bold; text-decoration: underline;">Author</span> <span style="font-weight: bold; font-style: italic;">myar</span> = JsonConvert.<span style="font-weight: bold;">DeserializeObject</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Author</span>&gt;(smpl, st);
    myar = JsonConvert.<span style="font-weight: bold;">DeserializeObject</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Author</span>&gt;(smpl, st);
    <span style="font-weight: bold;">foreach</span> (<span style="font-weight: bold; text-decoration: underline;">var</span> <span style="font-weight: bold; font-style: italic;">myarCourse</span> <span style="font-weight: bold;">in</span> myar.courses)
    {
        Console.<span style="font-weight: bold;">WriteLine</span>(myarCourse);
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org33bb86a" class="outline-4">
<h4 id="org33bb86a"><code>TypeNameHandling</code></h4>
<div class="outline-text-4" id="text-org33bb86a">
<p>
<b>None:</b> By default Json.NET does not read or write type names during deserialization.
</p>

<p>
<b>Objects:</b> Json.NET will write and use type names for objects but not collections.
</p>

<p>
<b>Arrays:</b> Json.NET will write and use type names for collections but not objects.
</p>

<p>
<b>Auto:</b> Json.NET will check whether an object/collection matches its declared property and
writes the type name if they do not match, e.g. a property with a type of Mammal has a
derived instance of Dog assigned. Auto will ensure that type information isn't lost when
serializing/deserializing automatically without having to write type names for every object.
</p>

<p>
<b>All:</b> Json.NET will write and use type names for objects and collections.
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">static</span> <span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">TypeNameHandl</span>()
{
    <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span> <span style="font-weight: bold; font-style: italic;">st</span> = <span style="font-weight: bold;">new</span> <span style="font-weight: bold; text-decoration: underline;">JsonSerializerSettings</span>();
    st.Formatting = Formatting.Indented;
    st.TypeNameHandling = TypeNameHandling.All;
    <span style="font-weight: bold; text-decoration: underline;">Author</span> <span style="font-weight: bold; font-style: italic;">k</span> = JsonConvert.<span style="font-weight: bold;">DeserializeObject</span>&lt;<span style="font-weight: bold; text-decoration: underline;">Author</span>&gt;(smpl);
    <span style="font-weight: bold; text-decoration: underline;">string</span> <span style="font-weight: bold; font-style: italic;">i</span> = JsonConvert.<span style="font-weight: bold;">SerializeObject</span>(k,st);
    Console.<span style="font-weight: bold;">WriteLine</span>(i);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org84d30a1" class="outline-4">
<h4 id="org84d30a1"><span class="todo TODO">TODO</span> <code>SerializationBinder</code></h4>
</div>
</div>
<div id="outline-container-org4a26168" class="outline-3">
<h3 id="org4a26168"><span class="todo TODO">TODO</span> Serialization Attributes</h3>
</div>
</div>
<div id="outline-container-org0f89d98" class="outline-2">
<h2 id="org0f89d98">See Also</h2>
<div class="outline-text-2" id="text-org0f89d98">
<ul class="org-ul">
<li><a href="https://www.newtonsoft.com/json/help/html/SerializingJSONFragments.htm">Deserializing Partial JSON Fragments</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="postamble" class="status">
<hr>
<a id="homeLink" style="text-decoration: none;" accesskey="h" href="/index.html">Navigate to home</a>
<script>
    var currentPage = window.location.href;

    var lastSlashIndex = currentPage.lastIndexOf('/');
    var currentPath = currentPage.substring(lastSlashIndex + 1);

    if (currentPath === "index.html" || currentPath === '') {
      var homeLink = document.getElementById("homeLink");
      homeLink.style.display = "none";
    }
</script>

<p> Generated by: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 30.0.50 (<a href="https://orgmode.org">Org</a> mode 9.6.6). Author: Salih Muhammed. Last build date: 2023-04-30 Sun 00:44.</p>
</div>
</div>
</div>
</body>
</html>